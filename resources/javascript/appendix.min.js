!function(e,i){"use strict";Genki.appendix={jisho:{mode:"ja",selected:[],cache:{box:{},group:{},search:{ja:[],en:[]}},init:function(){var e,n,a,s,t,c,o,d,l,p=storageOK&&localStorage.selectedDefinitions?localStorage.selectedDefinitions.split(","):[],r=[],h={},u=0;for(n in Genki.jisho){for(c=i.getElementById("list-"+n),o=i.createDocumentFragment(),f=0,j=Genki.jisho[n].length;f<j;f++)Genki.jisho[n][f].en&&((e=i.createElement("LI")).className="definition clear",e.dataset.def=n+f,a=Genki.jisho[n][f].ja.split("|"),e.innerHTML='<input class="def-selector genki_input_hidden" type="checkbox" onchange="Genki.appendix.jisho.updateCheckboxes(this, \''+e.dataset.def+"');\""+(-1!=p.indexOf(e.dataset.def)?"checked":"")+'><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span><span class="def-ja'+(a[1]?" def-furi":"")+'">'+a[0]+(a[1]?"<i>"+a[1]+"</i>":"")+'</span><span class="def-en">'+Genki.jisho[n][f].en+"</span>"+(Genki.jisho[n][f].v?' <span class="def-vtype">[<i>'+Genki.jisho[n][f].v+"</i>]</span>":"")+'<span class="def-label">'+Genki.jisho[n][f].l+"</span>",o.appendChild(e),h[t=Genki.jisho[n][f].en.replace(/^\(.*?\) |^to be |^to |^the |^it |^\.\.\.(?:,|)|^\d+-|^\d+|^"|^-/i,"").toLowerCase()]&&(t=t+"-"+ ++u),h[t]=e.cloneNode(!0),r.push(t),Genki.appendix.jisho.cache.box[e.dataset.def]={ja:e.firstChild},Genki.appendix.jisho.cache.group[n]||(Genki.appendix.jisho.cache.group[n]=[]),Genki.appendix.jisho.cache.group[n].push(e.firstChild),Genki.appendix.jisho.cache.search.ja.push(e));c.appendChild(o)}for(r=r.sort(),d="A",o=i.createDocumentFragment(),f=0,j=r.length;f<j;f++)(l=r[f].charAt(0))!=d&&(/[a-z]/.test(l)?(i.getElementById("list-"+d).appendChild(o),d=l.toUpperCase(),o=i.createDocumentFragment()):Genki.debug&&console.error('STRING CLEAN ERROR: "'+l+'" is an invalid definition key. The key must be alphabetical. (A-Z)\nDefinition Source: { ja : "'+h[r[f]].querySelector(".def-ja").innerHTML.replace(/<span class="def-en">.*?<\/span>/,"")+'", en : "'+h[r[f]].querySelector(".def-en").innerHTML+'" }')),(s=h[r[f]].innerHTML.match(/<span class="def-en">.*?<\/span>/))[0]&&(h[r[f]].innerHTML=h[r[f]].innerHTML.replace(/<span class="def-en">.*?<\/span>/,"").replace(/(<input.*?<\/span>)/,"$1"+s[0]+" "),o.appendChild(h[r[f]]),Genki.appendix.jisho.cache.box[h[r[f]].dataset.def].en=h[r[f]].firstChild,Genki.appendix.jisho.cache.group[d]||(Genki.appendix.jisho.cache.group[d]=[]),Genki.appendix.jisho.cache.group[d].push(h[r[f]].firstChild),Genki.appendix.jisho.cache.search.en.push(h[r[f]]));i.getElementById("list-"+d).appendChild(o);for(var k,g=i.querySelectorAll(".dictionary-group .section-title"),f=0,j=g.length;f<j;f++)k=Genki.appendix.jisho.cache.group[g[f].id.replace("section-","")],g[f].insertAdjacentHTML("beforeend",'<span class="definition-count">('+(k?k.length:0)+")</span>");i.getElementById("total-definitions").innerHTML="<strong>"+Genki.appendix.jisho.cache.search.ja.length+"</strong>",Genki.appendix.jisho.restoreSettings(),AddJumpArrowsTo(".dictionary-group .section-title","dictionary-top","ja"==GenkiLang?"辞書索引に戻る":"Return to the top of the dictionary"),i.getElementById("exercise-title").insertAdjacentHTML("beforeend"," Word Practice"),Genki.appendix.jisho.cache.search.res_ja=i.getElementById("dict-search-results-ja"),Genki.appendix.jisho.cache.search.res_en=i.getElementById("dict-search-results-en"),Genki.appendix.jisho.cache.search.hit_ja=i.getElementById("dict-search-hits-ja"),Genki.appendix.jisho.cache.search.hit_en=i.getElementById("dict-search-hits-en"),Genki.appendix.finishedLoading()},switchMode:function(e,n){var a={button:i.getElementById("ja-mode"),dict:i.getElementById("japanese-english")},s={button:i.getElementById("en-mode"),dict:i.getElementById("english-japanese")};"ja"==e&&"ja"!=Genki.appendix.jisho.mode?(a.button.className+=" active-mode",s.button.className=s.button.className.replace(" active-mode",""),s.dict.className+=" dict-hidden",a.dict.className=a.dict.className.replace(" dict-hidden","")):"en"==e&&"en"!=Genki.appendix.jisho.mode&&(s.button.className+=" active-mode",a.button.className=a.button.className.replace(" active-mode",""),a.dict.className+=" dict-hidden",s.dict.className=s.dict.className.replace(" dict-hidden","")),Genki.appendix.jisho.mode=e,!n&&storageOK&&(localStorage.genkiJishoMode=e)},updateCheckboxes:function(e,i,n){var a,s=Genki.appendix.jisho.cache.box[i],t=Genki.appendix.jisho.selected.indexOf(i);if(e.checked){for(a in s)e!=s[a]&&(s[a].checked=!0);-1==t&&Genki.appendix.jisho.selected.push(i)}else if(!e.checked){for(a in s)e!=s[a]&&(s[a].checked=!1);-1!=t&&Genki.appendix.jisho.selected.splice(t,1)}!n&&storageOK&&(localStorage.selectedDefinitions=Genki.appendix.jisho.selected)},selectAll:function(e,i){var n,a,s,t=i?Genki.appendix.jisho.cache.group[i]:Genki.appendix.jisho.cache.box;if(t){if(i)for(n=0,a=t.length;n<a;n++)t[n].checked!=e&&(t[n].checked=e,Genki.appendix.jisho.updateCheckboxes(t[n],t[n].parentNode.dataset.def,!0));else for(s in t)t[s].ja.checked!=e&&(t[s].ja.checked=e,Genki.appendix.jisho.updateCheckboxes(t[s].ja,t[s].ja.parentNode.dataset.def,!0));storageOK&&(localStorage.selectedDefinitions=Genki.appendix.jisho.selected)}},toggleList:function(e,i){if(i){var n=(o=e.parentNode.parentNode.parentNode.parentNode).querySelectorAll(".dictionary-group .group-selectors"),a=o.querySelectorAll(".dictionary-group .word-list"),s=o.querySelectorAll(".dictionary-group .toggle-word-list"),t=0,c=a.length;if(/Show/.test(e.innerHTML)){for(;t<c;t++)a[t].className=a[t].className.replace(" hidden",""),n[t].className=n[t].className.replace(" hidden",""),s[t].innerHTML=s[t].innerHTML.replace("Show","Hide").replace("表示","非表示");e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示")}else{for(;t<c;t++)/hidden/.test(a[t].className)||(a[t].className+=" hidden"),/hidden/.test(n[t].className)||(n[t].className+=" hidden"),s[t].innerHTML=s[t].innerHTML.replace("Hide","Show").replace("非表示","表示");e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示")}}else{var o;n=(o=e.parentNode.parentNode).querySelector(".group-selectors"),a=o.querySelector(".word-list");/hidden/.test(a.className)?(a.className=a.className.replace(" hidden",""),n.className=n.className.replace(" hidden",""),e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示")):(a.className+=" hidden",n.className+=" hidden",e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示"))}},search:function(n,a,s){Genki.appendix.jisho.searchTimeout&&e.clearTimeout(Genki.appendix.jisho.searchTimeout),Genki.appendix.jisho.searchTimeout=e.setTimeout(function(){var e,t,c=i.createDocumentFragment(),o=Genki.appendix.jisho.cache.search["res_"+a],d=Genki.appendix.jisho.cache.search["hit_"+a],l=Genki.appendix.jisho.cache.search[a],p=l.length,r=0,h=0;for(e in Genki.appendix.jisho.cache.box)Genki.appendix.jisho.cache.box[e]["search_"+a]&&delete Genki.appendix.jisho.cache.box[e]["search_"+a];if(Genki.appendix.jisho.cache.group["search_"+a]=[],o.innerHTML="",n)for(;h<p;h++)-1!=l[h].innerText.toLowerCase().indexOf(n.toLowerCase())&&(t=l[h].cloneNode(!0),c.appendChild(t),Genki.appendix.jisho.cache.box[l[h].dataset.def]["search_"+a]=t.firstChild,Genki.appendix.jisho.cache.group["search_"+a].push(t.firstChild),r++);if(!s&&!c.childNodes.length&&n&&/[\u3400-\u9faf]/.test(n)){var u=n.match(/[\u3400-\u9faf]+/);u&&u[0]&&Genki.appendix.jisho.search(u[0],a,!0)}else c.childNodes.length?(o.parentNode.querySelector(".group-selectors").style.visibility="",o.appendChild(c)):(o.parentNode.querySelector(".group-selectors").style.visibility="hidden",o.innerHTML=n?'<li><span class="en">No results found for "'+n+'".</span><span class="ja">「'+n+"」が見つかりませんでした。</span></li>":""),d.innerHTML=r?"("+r+") ":"";delete Genki.appendix.jisho.searchTimeout},300)},purgeBadSelectors:function(){for(var e=Genki.appendix.jisho.selected.length,n=0,a=[];n<e;n++)i.querySelector('#japanese-english [data-def="'+Genki.appendix.jisho.selected[n]+'"]')||a.push(Genki.appendix.jisho.selected[n]);if(a.length){for(;a.length;)Genki.appendix.jisho.selected.splice(Genki.appendix.jisho.selected.indexOf(a[0]),1),a.splice(0,1);storageOK&&(localStorage.selectedDefinitions=Genki.appendix.jisho.selected),e=Genki.appendix.jisho.selected.length}},launchExercise:function(){var e=Genki.appendix.jisho.selected.length;Genki.appendix.jisho.purgeBadSelectors(),e<5?GenkiModal.open({title:'<span class="en">Please select more words.</span><span class="ja">言葉をもっと選択してください。</span>',content:'<span class="en">Please select <b>'+(5-e)+"</b> more word"+(5-e==1?"":"s")+' to begin a practice exercise.</span><span class="ja">言葉を<b>'+(5-e)+"</b>つ選択してください。</span>"}):GenkiModal.open({title:'<span class="en">Begin Practice?</span><span class="ja">練習を始めますか？</span>',content:'<span class="en">Are you ready to practice your selected words?</span><span class="ja">選択した言葉を練習してもよろしいですか？</span>',buttonText:"Yes",keepOpen:!0,callback:function(){for(var n,a,s=Genki.appendix.jisho.selected,t={},c=0;c<e;c++)a=(n=i.querySelector('#japanese-english [data-def="'+s[c]+'"]')).querySelector(".def-furi i"),t[n.querySelector(".def-ja").innerHTML.replace(/<i>.*?<\/i>/,"")+(a?"|"+a.innerHTML:"")]=n.querySelector(".def-en").innerHTML;Genki.generateQuiz({format:"vocab",type:["multi","drag","writing","fill"],info:[Genki.lang.vocab_multi,Genki.lang.std_drag,Genki.lang.vocab_writing,Genki.lang.vocab_fill],quizlet:t}),Genki.appendix.showExercise()}})},manageWords:function(){GenkiModal.open({title:'<span class="en">Manage Selected Words</span><span class="ja">選択した言葉</span>',content:'<ol id="selected_words_list" class="dict-search-results"></ol>',buttonText:"Close",noFocus:!0,customSize:{top:"5%",left:"10%",bottom:"5%",right:"10%"}}),Genki.appendix.jisho.purgeBadSelectors();var e,n,a,s,t=i.getElementById("selected_words_list"),c=storageOK&&localStorage.selectedDefinitions?localStorage.selectedDefinitions.split(","):[],o=0,d=Genki.appendix.jisho.selected.length;if(d){for(e=i.createDocumentFragment();o<d;o++)(n=i.createElement("LI")).className="definition clear",n.dataset.def=Genki.appendix.jisho.selected[o],s=(a=Genki.jisho[Genki.appendix.jisho.selected[o].slice(0,1)][Genki.appendix.jisho.selected[o].slice(1)]).ja.split("|"),n.innerHTML='<input class="def-selector genki_input_hidden" type="checkbox" onchange="Genki.appendix.jisho.updateCheckboxes(this, \''+n.dataset.def+"');\""+(-1!=c.indexOf(n.dataset.def)?"checked":"")+'><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click(); Genki.appendix.jisho.removeSelectedWord(this);" onkeypress="if (event.key == \'Enter\') { this.previousSibling.click(); Genki.appendix.jisho.removeSelectedWord(this); }"></span><span class="def-ja'+(s[1]?" def-furi":"")+'">'+s[0]+(s[1]?"<i>"+s[1]+"</i>":"")+'</span>&nbsp;<span class="def-en">'+a.en+"</span>"+(a.v?' <span class="def-vtype">[<i>'+a.v+"</i>]</span>":"")+'<span class="def-label">'+a.l+"</span>",e.appendChild(n);t.appendChild(e),t.querySelector(".genki_pseudo_checkbox").focus()}else t.innerHTML='<span class="en">No words selected.</span><span class="ja">言葉は選択しません。</span>'},removeSelectedWord:function(e){var n=i.getElementById("selected_words_list");n.removeChild(e.parentNode),n.childNodes.length||(n.innerHTML='<span class="en">No words selected.</span><span class="ja">言葉が選択しません。</span>')},restoreSettings:function(){storageOK&&(localStorage.genkiJishoMode&&"ja"!=localStorage.genkiJishoMode&&Genki.appendix.jisho.switchMode(localStorage.genkiJishoMode,!0),localStorage.selectedDefinitions&&(Genki.appendix.jisho.selected=localStorage.selectedDefinitions.split(",")))}},showExercise:function(){i.getElementById("appendix-tool").style.display="none",i.getElementById("exercise").style.display=""},finishedLoading:function(){var e=i.querySelector(".loading");e.className=e.className.replace("loading","")}},i.getElementById("appendix-tool").appendChild(i.querySelector(".more-exercises").cloneNode(!0))}(window,document);