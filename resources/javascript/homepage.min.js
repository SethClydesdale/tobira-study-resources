!function(e,a){"use strict";if(a.getElementById("quick-search")){if(e.QuickSearcher={grammarIndex:/grammar-index/.test(e.location.href),search:a.getElementById("quick-search"),results:a.getElementById("quick-search-results"),hitsCounter:a.getElementById("quick-search-hits"),li:null,exLen:null,query:function(r){e.GenkiSearchTimeout&&e.clearTimeout(GenkiSearchTimeout),e.GenkiSearchTimeout=e.setTimeout(function(){var n,t=a.createDocumentFragment(),i=0,s=0;if(QuickSearcher.results.innerHTML="",r)for(;s<QuickSearcher.exLen;s++)(-1!=QuickSearcher.li[s].innerHTML.replace(/||<.*?>/g,"").toLowerCase().indexOf(r.toLowerCase())||QuickSearcher.li[s].dataset&&QuickSearcher.li[s].dataset.keywords&&-1!=QuickSearcher.li[s].dataset.keywords.toLowerCase().indexOf(r.toLowerCase()))&&QuickSearcher.li[s].getElementsByTagName("A")[0]&&!/note/.test(QuickSearcher.li[s].id)&&(QuickSearcher.grammarIndex?(n=a.createElement("LI")).innerHTML='<a href="#'+QuickSearcher.li[s].id+'">'+QuickSearcher.li[s].innerHTML.replace(/||<a.*?>.*?<\/a>/g,"")+"</a>":n=QuickSearcher.li[s].cloneNode(!0),n.dataset.lesson=QuickSearcher.grammarIndex?"L"+QuickSearcher.li[s].id.replace(/l(\d+)-p\d+/,"$1"):n.getElementsByTagName("A")[0].href.replace(/.*?\/(lesson-\d+).*|.*?\/(study-tools).*|.*?\/(appendix).*/,function(e,a,r,n){return a?a.charAt(0).toUpperCase()+a.split("-").pop():r?"tool":n?"appendix":void 0}),n.title=n.innerText,/^file|^http/.test(n.dataset.lesson)||(t.appendChild(n),i++));t.childNodes.length?QuickSearcher.results.appendChild(t):QuickSearcher.results.innerHTML=r?'<li><span class="en">No results found for "'+r+'".</span><span class="ja">「'+r+"」が見つかりませんでした。</span></li>":"",QuickSearcher.hitsCounter.innerHTML=i?"("+i+') <a class="fa" style="color:#17A;" href="#copy-search-link" title="'+("ja"==GenkiLang?"サーチリンクをコピーする":"Copy the search link")+'" onclick="QuickSearcher.copyLink(\''+r+"'); return false;\">&#xf0ea;</a>":"",delete e.GenkiSearchTimeout},300)},copyLink:function(a){GenkiModal.open({title:'<span class="en">Copy Search Link</span><span class="ja">サーチリンクをコピーする</span>',content:'<div class="center"><p><span class="en">You can copy the direct search link from the box below.</span><span class="ja">下の箱からサーチリンクがコピーできます。</span></p><textarea id="copied-search-link" onfocus="this.select();" style="width:80%;height:100px;">'+e.location.protocol+"//"+e.location.host+e.location.pathname+"?search="+encodeURIComponent(a)+'#quick-search-exercises</textarea><br><button class="button" onclick="CopyText(document.getElementById(\'copied-search-link\').value, this);"><i class="fa">&#xf0c5;</i><span class="en">Copy</span><span class="ja">コピーする</span></button></div>',focus:"#copied-search-link"})}},QuickSearcher.li=a.querySelectorAll(QuickSearcher.grammarIndex?".workbook-title":".lesson-exercises li"),QuickSearcher.exLen=QuickSearcher.li.length,e.location.search)for(var r,n=e.location.search.slice(1).split("&"),t=0,i=n.length;t<i;t++)if(r=n[t].split("="),/^search$/i.test(r[0])){QuickSearcher.search.value=decodeURIComponent(r[1]);break}QuickSearcher.search.oninput=function(){QuickSearcher.query(this.value)},QuickSearcher.search.value&&QuickSearcher.query(QuickSearcher.search.value)}t=0,i=(u=a.querySelectorAll("#quick-nav-list a")).length;for(var s,c=/grammar-index/.test(e.location.pathname)?/.*?lesson-grammar-(\d+).*/:/.*?lesson-(\d+).*/;t<i;t++)/lesson-\d+|lesson-grammar-\d+/.test(u[t])&&(s=u[t].href.replace(c,"$1"),u[t].insertAdjacentHTML("beforebegin",'<a class="sub-section-button fa" href="#toggle-sub-section" onclick="ToggleSubSection(this, '+s+'); return false;" title="'+("ja"==GenkiLang?"サブセクションをトグルする":"Toggle sub-sections")+'" data-open="false"></a>'),u[t].insertAdjacentHTML("afterend",'<ul style="display:none;"></ul>'),u[t].parentNode.className+=" noBullet");if(e.ToggleSubSection=function(e,r){var n=e.parentNode.lastChild;if(!n.innerHTML){for(var t=a.querySelectorAll("#exercises-"+r+" h3"),i=0,s=t.length,c="";i<s;i++)c+='<li><a href="#'+t[i].id+'">'+t[i].innerHTML.replace(/\s\(.*\)$/,"").replace(/<a.*?>.*?<\/a>/g,"")+"</a></li>";n.innerHTML=c}/none/.test(n.style.display)?(n.style.display="block",e.dataset.open=!0):(n.style.display="none",e.dataset.open=!1)},AddJumpArrowsTo(".lesson-title","quick-nav","ja"==GenkiLang?"クイックナビゲーションに戻る":"Jump to Quick Navigation"),storageOK&&localStorage.TobiraResults){var o,l=JSON.parse(localStorage.TobiraResults);for(o in l){var u;for(t=0,i=(u=a.querySelectorAll('a[href*="'+o+'/"]')).length;t<i;t++)u[t]&&u[t].parentNode.insertAdjacentHTML("beforeend",'&nbsp;<span class="exercise-results result--'+(100==l[o]?"perfect":l[o]>=70?"good":l[o]>=50?"average":"low")+'" title="'+("ja"==GenkiLang?"テストの得点":"Exercise score")+'"><i class="fa">'+(100==l[o]?"&#xf005;":l[o]>=70?"&#xf00c;":l[o]>=50?"&#xf10c;":"&#xf00d;")+"</i> "+l[o]+"%</span>")}}e.KN_RandomWord=function(){if(e.Genki&&Genki.jisho){if(!e.KN_WordList){var r,n=[];for(r in Genki.jisho)n.push.apply(n,Genki.jisho[r]);e.KN_WordList=n}var t=a.getElementById("random-word-content"),i=KN_WordList[Math.floor(Math.random()*KN_WordList.length)],s=i.ja.split("|");t&&(t.innerHTML='<div class="word-ja"><ruby>'+s[0]+"<rt>"+(s[1]?s[1]:"　")+'</rt></ruby></div><hr><div class="word-en"><span class="spoiler">'+i.en+"</span></div>")}},e.KN_RandomWord()}(window,document);