!function(e,t){"use strict";Genki.tools={type:"",addRow:function(e){for(var t=e.parentNode.cloneNode(!0),n=e.parentNode.parentNode,o=t.querySelectorAll("input, textarea"),l=o.length;l-- >0;)"checkbox"==o[l].type?o[l].checked=!1:o[l].value="";n.appendChild(t),n.scrollTop=9999,this.updateJSON()},removeRow:function(e){e.parentNode.parentNode.removeChild(e.parentNode),this.updateJSON()},updateUI:function(){var e=t.getElementById("study-tool-json");e.value||(e.value="quiz"==this.type?'[{"question":"","answers":[""]}]':"fill"==this.type?'{"quiz":""}':'{"":""}');var n,o,l,a,i,s=JSON.parse(e.value),u='<button class="button row-add" title="add" onclick="Genki.tools.addRow(this);"><i class="fa">&#xf067;</i></button><button class="button row-remove" title="remove" onclick="Genki.tools.removeRow(this);"><i class="fa">&#xf068;</i></button>',r="";if("vocab"==this.type)for(n in s)r+='<li class="item-row"><input type="text" placeholder="word/kanji" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(n)?n.split("|")[0]:n)+'">&nbsp;<input type="text" placeholder="furigana (optional)" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(n)?n.split("|")[1]:"")+'">&nbsp;<input type="text" placeholder="definition/kana" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(s[n])?s[n].split("|")[0]:s[n])+'">&nbsp;'+u+'<input type="text" placeholder="sentence (optional)" oninput="Genki.tools.updateJSON();" class="sentence-field" value="'+(/\|/.test(s[n])?s[n].split("|")[1]:"")+'"></li>';else if("spelling"==this.type)for(n in s)r+='<li class="item-row"><input type="text" placeholder="word/kanji" oninput="Genki.tools.updateJSON();" value="'+n+'">&nbsp;<input type="text" placeholder="furigana (optional)" oninput="Genki.tools.updateJSON();" value="'+(s[n]?s[n]:"")+'">&nbsp;'+u+"</li>";else if("quiz"==this.type)for(n=0,o=s.length;n<o;n++){for(i="",l=0,a=s[n].answers.length;l<a;l++)i+='<li class="quiz-answer"><input type="checkbox" title="Correct answer" onchange="Genki.tools.updateJSON();"'+(/^A/.test(s[n].answers[l])?" checked":"")+'><input type="text" placeholder="answer" oninput="Genki.tools.updateJSON();" value="'+(/^A|!/.test(s[n].answers[l])?s[n].answers[l].slice(1):s[n].answers[l])+'">'+u+"</li>";r+='<li class="item-row question-row"><textarea placeholder="question" oninput="Genki.tools.updateJSON();">'+s[n].question+"</textarea>"+u+"<ol>"+i+"</ol></li>"}else"fill"==this.type&&(r='<li class="item-row"><textarea oninput="Genki.tools.updateJSON();">'+s.quiz+"</textarea></li>");t.getElementById("study-tool-ui").innerHTML=r,"quiz"==Genki.tools.type&&CreateCustomInputs()},updateJSON:function(){var e,n,o,l,a,i,s=t.getElementById("study-tool-ui").querySelectorAll(".item-row"),u=0,r=s.length,c={};if("vocab"==this.type)for(;u<r;u++)c[(o=s[u].getElementsByTagName("INPUT"))[0].value+(o[1].value?"|"+o[1].value:"")]=o[2].value+(o[3].value?"|"+o[3].value:"");else if("spelling"==this.type)for(;u<r;u++)c[(o=s[u].getElementsByTagName("INPUT"))[0].value]=o[1].value;else if("quiz"==this.type)for(c=[];u<r;u++){for(a=[],e=0,n=(i=s[u].querySelectorAll(".quiz-answer")).length;e<n;e++)o=i[e].getElementsByTagName("INPUT"),a[e]=(o[0].checked?"A":"")+(!o[0].checked&&/^A/.test(o[1].value)?"!":"")+o[1].value;c[u]={question:s[u].getElementsByTagName("TEXTAREA")[0].value,answers:a}}else"fill"==this.type&&(c.quiz=s[u].getElementsByTagName("TEXTAREA")[0].value);l=t.getElementById("prettyCode").checked?JSON.stringify(c,"","  "):JSON.stringify(c),t.getElementById("study-tool-json").value=l,t.getElementById("downloadCode").href="data:,"+encodeURIComponent(l.replace(/\n/g,"\r\n")),storageOK&&(localStorage[{vocab:"customVocab",spelling:"customSpelling",quiz:"customQuiz",fill:"customWrittenQuiz"}[this.type]]=l)},restore:function(){var e={vocab:"customVocab",spelling:"customSpelling",quiz:"customQuiz",fill:"customWrittenQuiz"}[this.type];storageOK&&localStorage[e]?(t.getElementById("study-tool-json").value=localStorage[e],this.updateUI(),this.updateJSON()):this.updateJSON()},study:function(){t.getElementById("noStudyWarning").checked?this.begin():GenkiModal.open({title:'<span class="en">Ready to Study?</span><span class="ja">勉強の準備はOK？</span>',content:'<span class="en">Are you sure you\'re ready to study? Your custom exercise will be temporarily saved to the browser cache, however, if you want to use it again later, click "cancel", and then click "Save" to save it to a text document. (click "do not warn me" to disable this message)</span><span class="ja">カスタム練習コードはブラウザーのキャッシュで保存していますがセーブするのがおすすめです。勉強してもよろしいですか？（このメッセージが邪魔の場合は「注意しないで」をクリックしてください。）</span>'+(navigator.cookieEnabled&&!offlineEdge?"":'<br><br><div style="color:#F00;font-weight:bold;">WARNING: Cookies are blocked by your browser, so your custom exercise will NOT be saved. Please click "close" and then click "Save" to backup your custom exercise.</div>'),keepOpen:"vocab"==Genki.tools.type,callback:Genki.tools.begin})},begin:function(){var e=Genki.tools.type,n=t.getElementById("study-tool-json").value.replace(/<script.*?>/g,"<span>").replace(/<\/script>/g,"</span>").replace(/ on.*?=\\".*?\\"/g,"");t.getElementById("study-tool-editor").style.display="none",t.getElementById("exercise").style.display="","vocab"==e?Genki.generateQuiz({format:"vocab",type:["multi","drag","writing","fill"],info:[Genki.lang.vocab_multi,Genki.lang.std_drag,Genki.lang.vocab_writing,Genki.lang.vocab_fill],quizlet:JSON.parse(n)}):"spelling"==e?Genki.generateQuiz({type:"writing",info:Genki.lang.vocab_writing,columns:+t.getElementById("spellingColumns").value,quizlet:JSON.parse(n)}):"quiz"==e?Genki.generateQuiz({type:"multi",info:Genki.lang.std_questions,quizlet:JSON.parse(n)}):"fill"==e&&Genki.generateQuiz({type:"fill",info:Genki.lang.std_written,quizlet:JSON.parse(n).quiz})},importSnippet:function(e){GenkiModal.open({title:'<span class="en">Import Snippet?</span><span class="ja">練習コードをインポートしますか？</span>',content:'<span class="en">Are you sure you want to import this snippet? It will overwrite your current quiz settings.</span><span class="ja">今の練習コードは失います。インポートしてもよろしいですか？</span>',callback:function(){t.querySelector("#study-tool-ui textarea").value=t.getElementById(e).value,Genki.tools.updateJSON(),Genki.scrollTo("#quiz-settings")}})},loadCode:function(e,n){var o=n?e:e.files[0],l=new FileReader;l.onload=function(o){t.getElementById("study-tool-json").value=o.target.result,n||(e.value=""),Genki.tools.updateUI(),Genki.tools.updateJSON()},l.readAsText(o,"UTF-8")},dropFile:function(e){Genki.tools.loadCode(e.dataTransfer.files[0],!0),e.preventDefault()},settings:{prettify:function(e){this.handleCheckbox(e),Genki.tools.updateJSON()},toggleSentences:function(e){this.handleCheckbox(e),e.checked?t.body.className+=" show-sentences":t.body.className=t.body.className.replace(" show-sentences","")},handleCheckbox:function(e,n){n?(e.checked="true"==n,"showSentenceField"==e.id&&"true"==n&&(t.body.className+=" show-sentences")):storageOK&&(localStorage[e.id]=e.checked)},restore:function(){if(storageOK)for(var e,n=["noStudyWarning","prettyCode","showSentenceField"],o=0,l=n.length;o<l;o++)localStorage[n[o]]&&(e=t.getElementById(n[o]))&&this.handleCheckbox(e,localStorage[n[o]])}},finishedLoading:function(){CreateCustomInputs();var e=t.querySelector(".loading");e.className=e.className.replace("loading","")}},t.getElementById("study-tool-editor").appendChild(t.querySelector(".more-exercises").cloneNode(!0))}(window,document);